{
  "title": "HA ExpressRoute Hub-Spoke - Dual Region",
  "description": "Enterprise hub-spoke architecture with ExpressRoute, dual region for HA, and centralized security",
  "regions": [
    {
      "name": "West Europe (Primary)",
      "code": "westeurope",
      "isPrimary": true,
      "resourceGroups": [
        {
          "name": "rg-hub-weu",
          "resources": [
            {
              "type": "hubVnet",
              "name": "vnet-hub-weu",
              "properties": { "addressSpace": "10.0.0.0/16" },
              "subnets": [
                {
                  "type": "subnet",
                  "name": "AzureFirewallSubnet",
                  "properties": { "addressPrefix": "10.0.1.0/24" },
                  "resources": [
                    { "type": "firewall", "name": "fw-hub-weu" }
                  ]
                },
                {
                  "type": "subnet",
                  "name": "GatewaySubnet",
                  "properties": { "addressPrefix": "10.0.2.0/24" },
                  "resources": [
                    { "type": "vpnGateway", "name": "vgw-hub-weu", "properties": { "sku": "VpnGw2AZ" } }
                  ]
                },
                {
                  "type": "subnet",
                  "name": "AzureBastionSubnet",
                  "properties": { "addressPrefix": "10.0.3.0/24" },
                  "resources": [
                    { "type": "bastion", "name": "bas-hub-weu" }
                  ]
                }
              ]
            },
            { "type": "expressRoute", "name": "er-primary-weu", "properties": { "peeringLocation": "Amsterdam", "bandwidth": "1 Gbps" } },
            { "type": "publicIp", "name": "pip-fw-weu" },
            { "type": "publicIp", "name": "pip-vgw-weu" },
            { "type": "routeTable", "name": "rt-spoke-to-fw-weu" }
          ]
        },
        {
          "name": "rg-spoke-prod-weu",
          "resources": [
            {
              "type": "vnet",
              "name": "vnet-spoke-prod-weu",
              "properties": { "addressSpace": "10.1.0.0/16" },
              "peerings": [{ "name": "peer-to-hub", "remoteVnet": "vnet-hub-weu", "useRemoteGateways": true }],
              "subnets": [
                {
                  "type": "subnet",
                  "name": "subnet-web",
                  "properties": { "addressPrefix": "10.1.1.0/24" },
                  "resources": [
                    { "type": "appGateway", "name": "agw-prod-weu" },
                    { "type": "vmss", "name": "vmss-web-weu", "properties": { "instances": 3 } }
                  ]
                },
                {
                  "type": "subnet",
                  "name": "subnet-app",
                  "properties": { "addressPrefix": "10.1.2.0/24" },
                  "resources": [
                    { "type": "aks", "name": "aks-prod-weu", "properties": { "nodeCount": 3 } }
                  ]
                },
                {
                  "type": "subnet",
                  "name": "subnet-data",
                  "properties": { "addressPrefix": "10.1.3.0/24" },
                  "resources": [
                    { "type": "privateEndpoint", "name": "pe-sql-weu" },
                    { "type": "privateEndpoint", "name": "pe-cosmos-weu" },
                    { "type": "privateEndpoint", "name": "pe-storage-weu" }
                  ]
                }
              ]
            },
            { "type": "nsg", "name": "nsg-web-weu" },
            { "type": "nsg", "name": "nsg-app-weu" }
          ]
        },
        {
          "name": "rg-shared-weu",
          "resources": [
            { "type": "sqlServer", "name": "sql-prod-weu", "properties": { "failoverGroup": true } },
            { "type": "cosmosDb", "name": "cosmos-prod", "properties": { "multiRegionWrite": true } },
            { "type": "storageAccount", "name": "stprodweu001", "properties": { "replication": "GRS" } },
            { "type": "keyVault", "name": "kv-prod-weu" },
            { "type": "containerRegistry", "name": "acrprodweu" },
            { "type": "recoveryVault", "name": "rsv-prod-weu" }
          ]
        }
      ]
    },
    {
      "name": "North Europe (Secondary)",
      "code": "northeurope",
      "isPrimary": false,
      "resourceGroups": [
        {
          "name": "rg-hub-neu",
          "resources": [
            {
              "type": "hubVnet",
              "name": "vnet-hub-neu",
              "properties": { "addressSpace": "10.100.0.0/16" },
              "subnets": [
                {
                  "type": "subnet",
                  "name": "AzureFirewallSubnet",
                  "properties": { "addressPrefix": "10.100.1.0/24" },
                  "resources": [
                    { "type": "firewall", "name": "fw-hub-neu" }
                  ]
                },
                {
                  "type": "subnet",
                  "name": "GatewaySubnet",
                  "properties": { "addressPrefix": "10.100.2.0/24" },
                  "resources": [
                    { "type": "vpnGateway", "name": "vgw-hub-neu", "properties": { "sku": "VpnGw2AZ" } }
                  ]
                },
                {
                  "type": "subnet",
                  "name": "AzureBastionSubnet",
                  "properties": { "addressPrefix": "10.100.3.0/24" },
                  "resources": [
                    { "type": "bastion", "name": "bas-hub-neu" }
                  ]
                }
              ]
            },
            { "type": "expressRoute", "name": "er-secondary-neu", "properties": { "peeringLocation": "Dublin", "bandwidth": "1 Gbps" } },
            { "type": "publicIp", "name": "pip-fw-neu" },
            { "type": "publicIp", "name": "pip-vgw-neu" },
            { "type": "routeTable", "name": "rt-spoke-to-fw-neu" }
          ]
        },
        {
          "name": "rg-spoke-prod-neu",
          "resources": [
            {
              "type": "vnet",
              "name": "vnet-spoke-prod-neu",
              "properties": { "addressSpace": "10.101.0.0/16" },
              "peerings": [{ "name": "peer-to-hub", "remoteVnet": "vnet-hub-neu", "useRemoteGateways": true }],
              "subnets": [
                {
                  "type": "subnet",
                  "name": "subnet-web",
                  "properties": { "addressPrefix": "10.101.1.0/24" },
                  "resources": [
                    { "type": "appGateway", "name": "agw-prod-neu" },
                    { "type": "vmss", "name": "vmss-web-neu", "properties": { "instances": 3 } }
                  ]
                },
                {
                  "type": "subnet",
                  "name": "subnet-app",
                  "properties": { "addressPrefix": "10.101.2.0/24" },
                  "resources": [
                    { "type": "aks", "name": "aks-prod-neu", "properties": { "nodeCount": 3 } }
                  ]
                },
                {
                  "type": "subnet",
                  "name": "subnet-data",
                  "properties": { "addressPrefix": "10.101.3.0/24" },
                  "resources": [
                    { "type": "privateEndpoint", "name": "pe-sql-neu" },
                    { "type": "privateEndpoint", "name": "pe-cosmos-neu" },
                    { "type": "privateEndpoint", "name": "pe-storage-neu" }
                  ]
                }
              ]
            },
            { "type": "nsg", "name": "nsg-web-neu" },
            { "type": "nsg", "name": "nsg-app-neu" }
          ]
        },
        {
          "name": "rg-shared-neu",
          "resources": [
            { "type": "sqlServer", "name": "sql-prod-neu", "properties": { "failoverGroup": true, "role": "secondary" } },
            { "type": "storageAccount", "name": "stprodnen001", "properties": { "replication": "GRS" } },
            { "type": "keyVault", "name": "kv-prod-neu" },
            { "type": "recoveryVault", "name": "rsv-prod-neu" }
          ]
        }
      ]
    }
  ],
  "onPremises": [
    {
      "name": "On-Premises Datacenter",
      "location": "Amsterdam",
      "resources": [
        { "type": "localNetworkGateway", "name": "lgw-onprem-ams" },
        { "type": "vm", "name": "srv-dc-01" },
        { "type": "vm", "name": "srv-dc-02" }
      ]
    }
  ],
  "globalResources": [
    { "type": "frontDoor", "name": "afd-global-prod", "properties": { "origins": ["agw-prod-weu", "agw-prod-neu"] } },
    { "type": "trafficManager", "name": "tm-global-prod", "properties": { "routingMethod": "Performance" } },
    { "type": "dns", "name": "contoso.com" },
    { "type": "privateDns", "name": "privatelink.database.windows.net" },
    { "type": "privateDns", "name": "privatelink.documents.azure.com" }
  ],
  "connections": [
    { "from": "er-primary-weu", "to": "On-Premises Datacenter", "style": "expressroute", "label": "ExpressRoute Primary" },
    { "from": "er-secondary-neu", "to": "On-Premises Datacenter", "style": "expressroute", "label": "ExpressRoute Secondary" },
    { "from": "vnet-hub-weu", "to": "vnet-hub-neu", "style": "peering", "label": "Global VNet Peering" },
    { "from": "vnet-spoke-prod-weu", "to": "vnet-hub-weu", "style": "peering", "label": "Hub-Spoke Peering" },
    { "from": "vnet-spoke-prod-neu", "to": "vnet-hub-neu", "style": "peering", "label": "Hub-Spoke Peering" },
    { "from": "afd-global-prod", "to": "agw-prod-weu", "label": "Primary Origin" },
    { "from": "afd-global-prod", "to": "agw-prod-neu", "label": "Secondary Origin" },
    { "from": "sql-prod-weu", "to": "sql-prod-neu", "style": "dashed", "label": "Failover Group" },
    { "from": "pe-sql-weu", "to": "sql-prod-weu" },
    { "from": "pe-sql-neu", "to": "sql-prod-neu" },
    { "from": "pe-cosmos-weu", "to": "cosmos-prod" },
    { "from": "pe-cosmos-neu", "to": "cosmos-prod" }
  ]
}
